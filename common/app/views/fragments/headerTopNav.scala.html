@()(implicit page: model.Page, request: RequestHeader)

@import common.{LinkTo, Edition}
@import views.support.RenderClasses
@import navigation.NavMenu
@import navigation.UrlHelpers.{getJobUrl, Header, getReaderRevenueUrl}
@import navigation.ReaderRevenueSite.{Support, SupportSubscribe, SupportContribute, SupporterCTA}
@import conf.switches.Switches.{IdentityProfileNavigationSwitch, SearchSwitch}

@defining(NavMenu(page, Edition(request))) { navMenu: NavMenu =>
<header class="@RenderClasses(s" pillar-scheme--${navMenu.currentPillar.map(_.title).getOrElse("")}", "header-top-nav"
    )" role="banner">

    <div class="header-top-nav__full-width">
        <nav class="header-top-nav__inner gs-container" data-component="nav3" role="navigation"
            aria-label="Guardian sections">

            <div class="header-top-nav__top-bar hide-until-mobile">
                @defining(Edition(request).id.toLowerCase()) { editionId =>
                <div class="top-bar__commercial-items js-supporter-cta is-hidden">
                    <span class="top-bar__item__seperator hide-until-desktop"></span>
                    <a class="top-bar__item hide-until-desktop" data-link-name="nav3 : supporter-cta"
                        data-edition="@{editionId}" href="@getReaderRevenueUrl(SupporterCTA, Header)">
                        Subscriptions
                    </a>
                </div>

                @if(editionId != "au" || editionId == "uk") {
                <div class="top-bar__commercial-items">
                    <span class="top-bar__item__seperator hide-until-desktop"></span>
                    <a class="top-bar__item hide-until-desktop" data-link-name="nav3 : job-cta"
                        data-edition="@{editionId}" href="@getJobUrl(editionId)">
                        Search jobs
                    </a>
                </div>
                }

                @if(IdentityProfileNavigationSwitch.isSwitchedOn) {
                @fragments.nav.userAccountDropdown()
                }


                <a class="top-bar__item popup__toggle hide-until-desktop js-search-toggle"
                    href="https://www.google.co.uk/advanced_search?q=site:www.theguardian.com" data-is-ajax
                    data-link-name="nav3 : search" data-toggle="js-search-new">
                    @fragments.inlineSvg("search-36", "icon", List("top-bar__item__icon"))
                    Search
                </a>

                }
            </div>

            <div class="popup popup--default popup--search js-search-popup js-search-new is-off" aria-label="search"
                role="dialog" tabindex="-1" id="search-popup">
                <div class="js-search-placeholder"></div>
            </div>


            @if(!page.metadata.hasSlimHeader) {
            @fragments.nav.editionPickerDropdown()
            }

        </nav>
    </div>

    @defining(Edition(request).id.toLowerCase()) { editionId =>
    <a href="@LinkTo {/}" class="header-top-bar__logo" data-link-name="nav3 : logo">

        <span class="u-h">The Guardian - Back to home</span>

        @{
        if(editionId == "uk") {
        fragments.inlineSvg("guardian-best-website-logo", "logo")
        } else {
        fragments.inlineSvg("the-guardian-logo", "logo")
        }
        }
    </a>
    }
    <div class="header-top-bar__cta-bar"></div>

    @fragments.nav.headerMenu(navMenu)

    <nav>
        <ul class="pillars">
            @navMenu.pillars.map { link =>
            <li class="pillars__item">
                <a class="@RenderClasses(Map(
                        " pillar-link--current-section" -> ((link.title ==
                    navMenu.currentPillar.map(_.title).getOrElse("")) && !page.metadata.hasSlimHeader)
                    ), "pillar-link", s"pillar-link--${link.title}")"
                    href="@LinkTo(link.url)"
                    data-link-name="nav3 : primary : @link.title">

                    @link.title
                </a>
            </li>
            }
        </ul>

        <input type="checkbox" id="main-menu-toggle" class="veggie-burger-fallback js-enhance-checkbox u-h"
            data-link-name="nav3 : veggie-burger : show" aria-controls="main-menu" tabindex="-1">

        <label for="main-menu-toggle" class="js-change-link header-top-bar__menu-toggle"
            data-link-name="nav3 : veggie-burger : show" tabindex="0">

            <span class="veggie-burger hide-from-desktop">
                <span class="veggie-burger__icon"></span>
            </span>

            <span class="pillar-link pillar-link--dropdown pillar-link--sections hide-until-desktop">
                <span class="u-h">Show</span>
                More
                <i class="pillar-link--dropdown__icon"></i>
            </span>
        </label>
    </nav>

    @fragments.nav.subNav(navMenu, page.metadata.designType)
</header>
}
