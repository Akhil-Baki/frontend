@import pa.Round
@import views.support.`package`.Seq2zipWithRowInfo
@(page: model.Page, competition: model.Competition, competitionStage: football.model.KnockoutSpider, round: Round, next: Option[pa.FootballMatch])(implicit request: RequestHeader, context: model.ApplicationContext)


@knockoutSpider(knockoutStage: football.model.KnockoutSpider, round: Round) = {
    @knockoutList(competition, competitionStage, round, true)
    <div class="football-knockout-chart football-knockout-chart--@knockoutStage.rounds.length-rounds u-cf">
        <div class="football-rounds football-rounds--first-half">
        @defining(knockoutStage.roundMatches(round)) { matches =>
            @if(matches.length != 1){
                <div class="football-round football-round--@matches.length-matches @if(knockoutStage.isActiveRound(round)){football-round--active}">
                    <div class="football-round__name">@round.name.getOrElse("")</div>

                    @defining(matches.length/2) { half =>
                        <div class="football-round__matches">
                            @matches.take(half).map{ m =>
                                @football.views.html.wallchart.knockoutMatch(m, round)
                            }
                        </div>
                    }
                </div>
            }
        }
        </div>
        <div class="football-rounds football-rounds--second-half">
        @defining(knockoutStage.roundMatches(round)) { matches =>
            @if(matches.length != 1){
                <div class="football-round football-round--@matches.length-matches @if(knockoutStage.isActiveRound(round)){football-round--active}">
                    <div class="football-round__name">@round.name.getOrElse("")</div>
                    @defining(matches.length/2) { half =>
                        <div class="football-round__matches">
                            @matches.drop(half).map{ m =>
                                @football.views.html.wallchart.knockoutMatch(m, round)
                            }
                        </div>
                    }
                </div>
            }
        }
        </div>
        <div class="football-rounds football-rounds--finals">
        @defining(knockoutStage.roundMatches(round)) { matches =>
            @if(matches.length == 1){
                <div class="football-round
                                football-round--@matches.length-matches
                football-round--final
                    @if(knockoutStage.isActiveRound(round)){football-round--active}
                    @round.name.filter(n => n == "3rd/4th Play-Offs" || n == "3rd/4th Place Play-Off").map{ name => football-round--playoff}">
                    <div class="football-round__name">@round.name.getOrElse("")</div>
                    <div class="football-round__matches">
                    @matches.map{ m =>
                        @football.views.html.wallchart.knockoutMatch(m, round)
                    }
                    </div>
                </div>
            }
        }
        </div>
        <div class="football-knockout-chart__timezone">All matches are in UK time</div>
    </div>

}

@knockoutList(competition: model.Competition, knockoutStage: football.model.KnockoutSpider, round: Round,  hasSpider: Boolean) = {
    <div class="football-knockouts @if(hasSpider){football-knockouts--has-spider}">
        @round.name.map { name =>
                <ul class="u-unstyled u-cf">
                    <li>
                    @{knockoutStage.matchesList(competition, round).matchesGroupedByDateAndCompetition.zipWithRowInfo.map { case ((date, competitionMatches), info) =>
                        competitionMatches.map { case (competition, matches) =>
                            football.views.html.matchList.matchesList(matches, competition, date,
                                heading = if(info.isFirst) Option(("Fixtures and results", None)) else None
                            )
                        }
                    }}
                    </li>
                </ul>
        }
    </div>
}



<!DOCTYPE html>

<html class="js-off is-not-modern id--signed-out" lang="en-GB">
    <head>
        <meta name="robots" content="noindex, nofollow" />
        @fragments.head(Some("football"), Html(""))(page, request, context)
        <script>guardian.config.page.isFootballWorldCup2014 = true;</script>
        </head>
    <body id="top" itemscope itemtype="http://schema.org/WebPage">
        <div id="js-context" class="football-wallchart-embed">
            <div class="l-side-margins wc-overview">
                    <div class="facia-container facia-container--layout-content">
                        <div class="container">
                            <div class="facia-container__inner">
                                <div class="container__border hide-on-mobile"></div>
                                <div class="fc-container__header">
                                    <h3 class="container__title">
                                        <span class="container__title__label u-text-hyphenate">Knockout stage</span>
                                    </h3>
                                </div>
                                <div class="container__body">
                                    <div data-link-name="@competition.fullName knockout chart">
                                        @knockoutSpider(competitionStage, round)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                @fragments.analytics.base()(page, request, context)
            </div>
        </div>
    </body>
</html>


